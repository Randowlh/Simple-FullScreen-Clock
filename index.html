<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Simple FullScrean Clock.</title>
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="mobile-web-app-capable" content="yes">
  <link rel='manifest' href='./manifest.json'>
  <link rel="icon" href="./favicon.ico" type="image/x-icon">
  <style>
    @font-face {
      font-family: 'number';
      src:url('src/clock-number.ttf');
    }
    html,
    body {
      font-family: number;
      width: 100vw;
      height: 100vh;
      padding: 0;
      margin: 0;
      overflow: hidden;
      background-color: #000000;
    }
    #clock {
      position: relative;
      width: 100vw;
      height: 100vh;
      color: white;
      text-align: center;
      line-height: 100vh;
      font-size: 16vw;
      transition: opacity 1s;
    }
    #hour,
    #minute,
    #sep {
      transition: opacity 1s;
    }
  </style>
</head>
<body>
  <div id="clock">
    <span id="hour"></span>
    <span id="sep">:</span>
    <span id="minute"></span>
  </div>
  <script>
    // 两位数字
    const dbNum = function(num){ return num>9?num:'0'+num }
    // 文字尺寸计算
    const fontSize = function(){
      const widthMax = window.innerWidth * 19 / 50
      const heightMax = window.innerHeight
      return widthMax > heightMax ? heightMax : widthMax
    }
    // 获取当前时间
    const refreshTime = function(){
      const now = new Date()
      const hour   = dbNum( now.getHours() )
      const minute = dbNum( now.getMinutes() )
      const second = dbNum( now.getSeconds() )
      const opacity = (Math.sin(Math.PI * Number(second%30)/15-1) * 0.2 + 0.5).toFixed(2)

      document.querySelector('#hour').innerHTML = hour
      document.querySelector('#minute').innerHTML = minute
      document.querySelector('#sep').style.opacity = Number(second)%2
      document.querySelectorAll('#clock > *').forEach(el=>el.style.fontSize = fontSize()+'px')
      document.querySelector('#clock').style.opacity = opacity
    }
    const clock = document.getElementById('clock');
    window.addEventListener('message', function(e) {
      if(e.data === 'refresh') {
        refreshTime()
      }
    }, false);

    const duration = 1; /* 1s */
    const iframe = document.createElement('iframe');
    iframe.style.display = 'none';
    iframe.src = 'data:text/html,%3C%21DOCTYPE%20html%3E%0A%3Chtml%3E%0A%3Chead%3E%0A%09%3Cmeta%20charset%3D%22utf-8%22%20%2F%3E%0A%09%3Cmeta%20http-equiv%3D%22refresh%22%20content%3D%22'+ duration +'%22%20id%3D%22metarefresh%22%20%2F%3E%0A%09%3Ctitle%3Ex%3C%2Ftitle%3E%0A%3C%2Fhead%3E%0A%3Cbody%3E%0A%09%3Cscript%3Etop.postMessage%28%27refresh%27%2C%20%27%2A%27%29%3B%3C%2Fscript%3E%0A%3C%2Fbody%3E%0A%3C%2Fhtml%3E';
    document.body.insertBefore(iframe, document.body.childNodes[0]);
  </script>
</body>
</html>